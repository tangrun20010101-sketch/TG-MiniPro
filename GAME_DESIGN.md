# 春节福牌消除游戏 - 游戏设计文档

## 🎮 游戏概述

这是一个类似《羊了个羊》的消除类小游戏，主题是春节福牌。玩家需要在150秒内消除场上的所有福牌，通过策略和运气来通关。

## 📋 游戏规则

### 一、游戏目标

**主要目标：** 在150秒内，把场上的「福牌」全部消掉。

**失败条件：** 如果托盘被塞满（7张牌）又无法消除，游戏结束。

### 二、基础规则

#### 1. 牌面说明

场上会出现很多叠在一起的「春节福牌」，分为三层品质：

**普通卡（98%）：**
- 🧧 红包、🎆 鞭炮、🥟 饺子、🏮 灯笼、福字、💰 元宝等
- 10 张普通卡可兑换 1 张麒麟卡
- 只负责「帮过关」

**麒麟卡（1%）：**
- 与金币 1:1 通兑，偏幸运消费
- 效果示例：「开局随机消一组」「多一个槽位（本局）」

**财神卡（0.5%）：**
- 每张可兑换 1 USDC，直接跟钱挂钩
- 局内效果：本局自动帮你摆放 3 张卡
- 玩家心智：抽到财神卡 = 离提现更近了

#### 2. 选牌 & 托盘机制

- **点击选牌：** 点击一张福牌，这张牌会被放入底部的「托盘」
- **托盘容量：** 初始 7 个槽位，可用 20 金币永久增加 1 个槽位
- **消除规则：** 当托盘中**相同图案的牌累积到3张**时，会自动消除，为托盘腾出位置
- **牌堆规则：** 只有最上层的牌可以被点击，下层被遮挡的牌需要先消除上层才能点击

#### 3. 失败条件

当托盘已经有7张牌，并且**没有任意一组三张相同可以消除**时：
→ 本局游戏结束（失败）

#### 4. 通关条件

成功把场上所有牌都消除完，就算**通关**。
没有要求必须用完150秒，只要牌消完就立即结算。

### 三、时间限制

- 每局有**150秒倒计时**
- 即使没能全部消完，只要时间到了，也会根据你已经消除的牌数量来结算奖励
- 时间到后自动结算，显示获得的福签和奖励

### 四、抽奖与卡牌效果

**抽奖入口：** 首页「抽奖」按钮 → 抽奖页

**抽奖消耗（金币）：**
- 10 金币 抽 1 次
- 90 金币 抽 10 次（送 1 次，等于 11 发）

**抽奖交互：**
- 转盘固定，中心为按钮，按钮外圈有指针
- 用户按住按钮，松手后请求服务端，服务端返回结果角度
- 指针按按下时长旋转到该角度停止（按得越久转得越久，仅影响动画）

**抽奖概率：** 10 档位（每档 36°），麒麟 36° 占 1%，财神 324° 占 0.01%，其余 8 档普通牌均分 98.99%

> 详细设计见 [LOTTERY_DESIGN.md](./LOTTERY_DESIGN.md)

**麒麟卡局内效果：**
- 「开局随机消一组」
- 「多一个槽位（本局）」

**财神卡局内效果：**
- 「本局自动帮你摆放 3 张卡」

### 五、道具系统

#### 每日免费道具（每天重置）

每天免费获得：
- **撤回**：1次（撤销上一次选牌操作）
- **洗牌**：1次（重新随机排列场上可见的牌）
- **移除**：1次（移除托盘中的一张牌）

#### 金币消耗

**复活：** 通关失败时，花 5 金币立即复活再来一局

**卡槽扩展：** 20 金币 = 永久增加 1 个槽位（初始 7 个）

**抽卡：** 10 金币/次，90 金币/十连（送 1 次）

### 六、模式选择

每局开始前，玩家可以选择两种模式之一：

#### 1. 免费模式
- **消耗：** 不消耗金币/积分
- **奖励：** 通关或达到一定分数时获得积分（10000 积分 = 1 金币）

#### 2. 小赌模式
- **消耗：** 消耗少量金币
- **奖励：** 通关获得更多积分，失败可花 5 金币复活

### 七、排名系统

- **排名周期：** 按日/周排名
- **排名依据：** 当日积分或通关次数
- **奖励：** 可结合金币、麒麟卡等

> 详细经济系统见 [ECONOMY_SYSTEM.md](./ECONOMY_SYSTEM.md)

## 🎯 游戏流程

### 游戏开始流程

1. 玩家选择模式（免费模式/小赌模式）
2. 如果是小赌模式，扣除相应代币
3. 初始化游戏：
   - 生成随机牌堆（多层叠放）
   - 初始化托盘（7个空位）
   - 开始150秒倒计时
   - 显示可用道具数量

### 游戏进行流程

1. 玩家点击场上可见的福牌
2. 选中的牌移入托盘
3. 检查是否有3张相同牌可以消除
4. 如果有，自动消除并播放动画
5. 如果没有，继续游戏
6. 检查是否失败（托盘满且无法消除）
7. 检查是否通关（所有牌消除完毕）

### 游戏结束流程

**通关：**
- 显示通关动画
- 计算奖励（积分等）
- 记录成绩到排名系统

**失败：**
- 显示失败提示
- 提供「花 5 金币复活」选项
- 提供重新开始选项

**时间到：**
- 停止游戏
- 根据已消除的牌数量计算奖励
- 显示结算界面

## 💰 经济系统

三层货币体系（偏挖矿玩乐花时间）：

| 层级 | 名称 | 说明 |
|------|------|------|
| 层 1 | USDC | 现实货币，后台结算 |
| 层 2 | 金币 | 通兑货币，1 USDC = 10 金币，充 10U 送 10 金币 |
| 层 3 | 积分 | 游戏积分，10000 积分 = 1 金币 |

**金币用途：** 复活（5）、卡槽扩展（20/个）、抽卡（10/次，90/十连）

**卡牌通兑：** 普通卡 10:1→麒麟卡，麒麟卡 1:1→金币，财神卡 1:1→USDC

> 完整设计见 [ECONOMY_SYSTEM.md](./ECONOMY_SYSTEM.md)

## 📊 数据结构设计

### 牌堆结构

```javascript
{
  id: "card_001",
  type: "red_packet", // 牌类型
  layer: 1, // 层级（1为最上层）
  position: { x: 100, y: 200 }, // 位置
  isVisible: true, // 是否可见（上层遮挡）
  isSpecial: false // 是否为特殊牌
}
```

### 托盘结构

```javascript
{
  slots: [
    { card: null, id: 0 },
    { card: null, id: 1 },
    // ... 最多7个（可扩展）
  ],
  maxSlots: 7 // 最大卡槽数
}
```

### 游戏状态

```javascript
{
  gameId: "game_001",
  userId: "user_123",
  mode: "free", // "free" | "bet"
  startTime: 1234567890,
  endTime: null,
  timeLimit: 150, // 秒
  remainingTime: 150,
  score: 0,
  eliminatedCards: 0,
  totalCards: 100,
  tray: [], // 托盘中的牌
  board: [], // 场上的牌
  props: {
    undo: 1,
    shuffle: 1,
    remove: 1
  },
  status: "playing" // "playing" | "win" | "lose" | "timeout"
}
```

## 🎨 UI/UX设计要点

### 游戏界面布局

```
┌─────────────────────────┐
│  时间: 150s  [道具按钮] │
├─────────────────────────┤
│                         │
│      游戏区域           │
│    (多层叠放的牌)       │
│                         │
├─────────────────────────┤
│  托盘: [][][][][][][]   │
│  (最多7个卡槽)          │
└─────────────────────────┘
```

### 交互反馈

- **点击牌：** 牌有缩放动画，移入托盘有滑动动画
- **消除牌：** 3张相同牌闪烁后消失，有粒子效果
- **失败：** 托盘满时，无法点击的牌显示红色边框
- **通关：** 全屏庆祝动画，烟花效果

## 🔧 技术实现要点

### 牌堆生成算法

- 确保有解（至少有一条路径可以通关）
- 随机分布但保证可玩性
- 特殊牌随机出现，但保证稀有度

### 消除检测算法

- 实时检测托盘中的牌
- 当有3张相同时立即触发消除
- 消除后检查是否通关或失败

### 道具实现

- **撤回：** 保存操作历史，支持回退
- **洗牌：** 重新随机排列可见牌的位置
- **移除：** 从托盘中移除指定牌

## 📈 后续扩展功能

- 每日任务系统
- 成就系统
- 好友对战模式
- 赛季系统
- NFT交易市场
- 更多特殊牌类型

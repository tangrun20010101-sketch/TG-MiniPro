# 春节福牌消除游戏 - 游戏设计文档

## 🎮 游戏概述

这是一个类似《羊了个羊》的消除类小游戏，主题是春节福牌。玩家需要在150秒内消除场上的所有福牌，通过策略和运气来通关。

## 📋 游戏规则

### 一、游戏目标

**主要目标：** 在150秒内，把场上的「福牌」全部消掉。

**失败条件：** 如果托盘被塞满（7张牌）又无法消除，游戏结束。

### 二、基础规则

#### 1. 牌面说明

场上会出现很多叠在一起的「春节福牌」：

**普通福牌：**
- 🧧 红包
- 🎆 鞭炮
- 🥟 饺子
- 🏮 灯笼
- 福 福字
- 💰 元宝

**特殊牌（稀有）：**
- 🧙 财神（消除后获得NFT）
- 🎇 烟花（消除后获得NFT）

#### 2. 选牌 & 托盘机制

- **点击选牌：** 点击一张福牌，这张牌会被放入底部的「托盘」
- **托盘容量：** 托盘最多只能放7张牌（可充值扩展）
- **消除规则：** 当托盘中**相同图案的牌累积到3张**时，会自动消除，为托盘腾出位置
- **牌堆规则：** 只有最上层的牌可以被点击，下层被遮挡的牌需要先消除上层才能点击

#### 3. 失败条件

当托盘已经有7张牌，并且**没有任意一组三张相同可以消除**时：
→ 本局游戏结束（失败）

#### 4. 通关条件

成功把场上所有牌都消除完，就算**通关**。
没有要求必须用完150秒，只要牌消完就立即结算。

### 三、时间限制

- 每局有**150秒倒计时**
- 即使没能全部消完，只要时间到了，也会根据你已经消除的牌数量来结算奖励
- 时间到后自动结算，显示获得的福签和奖励

### 四、特殊牌效果

**特殊牌机制：**
- 特殊牌（财神、烟花）会随机出现在牌堆中
- 当点击特殊牌时，会刷新出另外两个隐藏的特殊牌
- 如果成功消除一组3张特殊牌，则获得这个牌作为**NFT奖励**

**特殊牌类型：**
- 🧙 **财神牌**：消除后获得财神NFT
- 🎇 **烟花牌**：消除后获得烟花NFT

### 五、道具系统

#### 每日免费道具（每天重置）

每天免费获得：
- **撤回**：1次（撤销上一次选牌操作）
- **洗牌**：1次（重新随机排列场上可见的牌）
- **移除**：1次（移除托盘中的一张牌）

#### 充值道具（USDC/TON支付）

**每日充值（2 USDC/TON）：**
- 多一次撤回，或
- 多一次洗牌，或
- 多一次移除

**永久升级（7 USDC/TON）：**
- 增加1个托盘卡槽（从7个增加到8个，可多次购买）

**局内充值（1 USDC/TON）：**
- 选择一次撤回，或
- 选择一次洗牌，或
- 选择一次移除

### 六、模式选择（轻度赌博感）

每局开始前，玩家可以选择两种模式之一：

#### 1. 免费模式
- **消耗：** 不消耗代币/积分
- **奖励：** 
  - 通关或达到一定分数时，获得**少量福签**作为奖励
  - 无额外代币奖励

#### 2. 小赌模式
- **消耗：** 需要消耗少量代币/积分（或USDC/TON，由系统设置）
- **奖励：**
  - 如果本局表现达标（通关、达到某分数）：
    - 获得的**福签数量 ×2 或更多倍**
    - 同时获得额外积分/代币奖励
  - 如果失败：
    - 消耗的代币/积分不返还
    - 可以适当设计「安慰奖」（少量福签）

### 七、排名系统

- **排名周期：** 每两天排名一次
- **奖励：** 排名最高的玩家可以获取**NFT奖励**
- **排名依据：** 根据玩家在排名周期内的总得分或通关次数

### 八、红包系统

玩家可以发送红包给朋友（USDC/TON）

**红包金额获取概率：**

| 获取金额 | 概率 |
|---------|------|
| 90% | 55% |
| 100% | 42.5% |
| 150% | 2.5% |

**示例：**
- 发送100 USDC红包
- 朋友打开后：
  - 55%概率获得90 USDC
  - 42.5%概率获得100 USDC
  - 2.5%概率获得150 USDC

## 🎯 游戏流程

### 游戏开始流程

1. 玩家选择模式（免费模式/小赌模式）
2. 如果是小赌模式，扣除相应代币
3. 初始化游戏：
   - 生成随机牌堆（多层叠放）
   - 初始化托盘（7个空位）
   - 开始150秒倒计时
   - 显示可用道具数量

### 游戏进行流程

1. 玩家点击场上可见的福牌
2. 选中的牌移入托盘
3. 检查是否有3张相同牌可以消除
4. 如果有，自动消除并播放动画
5. 如果没有，继续游戏
6. 检查是否失败（托盘满且无法消除）
7. 检查是否通关（所有牌消除完毕）

### 游戏结束流程

**通关：**
- 显示通关动画
- 计算奖励（福签、代币等）
- 记录成绩到排名系统
- 显示获得的NFT（如果有）

**失败：**
- 显示失败提示
- 如果是小赌模式，显示消耗的代币
- 显示安慰奖（如果有）
- 提供重新开始选项

**时间到：**
- 停止游戏
- 根据已消除的牌数量计算奖励
- 显示结算界面

## 💰 经济系统

### 代币/积分

- **获取方式：**
  - 通关游戏
  - 完成每日任务
  - 充值购买（USDC/TON）
  - 红包系统

- **消耗方式：**
  - 小赌模式入场费
  - 购买道具
  - 发送红包

### 福签

- **用途：** 兑换奖励、参与活动
- **获取方式：** 通关游戏、完成每日任务

### NFT

- **类型：** 财神NFT、烟花NFT
- **获取方式：** 消除特殊牌组、排名奖励
- **用途：** 收藏、展示、未来可能的功能

## 📊 数据结构设计

### 牌堆结构

```javascript
{
  id: "card_001",
  type: "red_packet", // 牌类型
  layer: 1, // 层级（1为最上层）
  position: { x: 100, y: 200 }, // 位置
  isVisible: true, // 是否可见（上层遮挡）
  isSpecial: false // 是否为特殊牌
}
```

### 托盘结构

```javascript
{
  slots: [
    { card: null, id: 0 },
    { card: null, id: 1 },
    // ... 最多7个（可扩展）
  ],
  maxSlots: 7 // 最大卡槽数
}
```

### 游戏状态

```javascript
{
  gameId: "game_001",
  userId: "user_123",
  mode: "free", // "free" | "bet"
  startTime: 1234567890,
  endTime: null,
  timeLimit: 150, // 秒
  remainingTime: 150,
  score: 0,
  eliminatedCards: 0,
  totalCards: 100,
  tray: [], // 托盘中的牌
  board: [], // 场上的牌
  props: {
    undo: 1,
    shuffle: 1,
    remove: 1
  },
  status: "playing" // "playing" | "win" | "lose" | "timeout"
}
```

## 🎨 UI/UX设计要点

### 游戏界面布局

```
┌─────────────────────────┐
│  时间: 150s  [道具按钮] │
├─────────────────────────┤
│                         │
│      游戏区域           │
│    (多层叠放的牌)       │
│                         │
├─────────────────────────┤
│  托盘: [][][][][][][]   │
│  (最多7个卡槽)          │
└─────────────────────────┘
```

### 交互反馈

- **点击牌：** 牌有缩放动画，移入托盘有滑动动画
- **消除牌：** 3张相同牌闪烁后消失，有粒子效果
- **失败：** 托盘满时，无法点击的牌显示红色边框
- **通关：** 全屏庆祝动画，烟花效果

## 🔧 技术实现要点

### 牌堆生成算法

- 确保有解（至少有一条路径可以通关）
- 随机分布但保证可玩性
- 特殊牌随机出现，但保证稀有度

### 消除检测算法

- 实时检测托盘中的牌
- 当有3张相同时立即触发消除
- 消除后检查是否通关或失败

### 道具实现

- **撤回：** 保存操作历史，支持回退
- **洗牌：** 重新随机排列可见牌的位置
- **移除：** 从托盘中移除指定牌

## 📈 后续扩展功能

- 每日任务系统
- 成就系统
- 好友对战模式
- 赛季系统
- NFT交易市场
- 更多特殊牌类型

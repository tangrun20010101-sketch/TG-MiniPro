<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>æ¸¸æˆä¸­ - æ˜¥èŠ‚ç¦ç‰Œæ¶ˆé™¤</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="/css/common.css">
  <link rel="stylesheet" href="/css/game.css">
</head>
<body class="page-game">
  <div id="loading" class="loading-screen">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <p class="loading-text">åŠ è½½èµ„æºä¸­...</p>
      <p class="loading-progress">0%</p>
    </div>
  </div>

  <div class="viewport-scaler">
  <div id="game-container" class="game">
    <div class="bg-wrap">
      <img id="game-bg" class="game-bg" src="" alt="">
    </div>

    <!-- 1. æ ‡é¢˜åŒºåŸŸ ä»å·¦åˆ°å³ï¼šè¿”å›ã€ç§¯åˆ†ã€ä»£å¸ã€è®¡æ—¶ã€è®¾ç½® -->
    <header class="game-header">
      <button type="button" class="header-btn header-btn-back" id="btn-menu" title="è¿”å›" aria-label="è¿”å›">
        <img src="/assets/images/icons/header/back.png" alt="è¿”å›" class="header-btn-icon">
      </button>
      <div class="header-stats">
        <div class="stat-item stat-jifen">
          <img src="/assets/images/icons/stats/jifen.png" alt="ç§¯åˆ†" class="stat-icon">
          <span class="stat-value" id="score">0</span>
        </div>
        <div class="stat-item stat-daibi">
          <img src="/assets/images/icons/stats/daibi.png" alt="ä»£å¸" class="stat-icon">
          <span class="stat-value" id="credit">0</span>
        </div>
      </div>
      <div id="ton-connect-game" class="header-ton-connect"></div>
      <button type="button" class="header-btn header-btn-settings" id="btn-settings" title="è®¾ç½®" aria-label="è®¾ç½®">
        <img src="/assets/images/icons/header/setting.png" alt="è®¾ç½®" class="header-btn-icon">
      </button>
    </header>

    <!-- 2. å¡ç‰‡åŒºåŸŸ y:60-500 å¡ç‰‡ 90Ã—90 è¾¹ç¼˜å¯æº¢å‡º -->
    <main class="game-main">
      <canvas id="board-canvas"></canvas>
    </main>

    <!-- å€’æ•°è®¡æ—¶ æ‰˜ç›˜ä¸Šæ–¹ -->
    <div class="game-timer" id="game-timer">
      <span id="timer-value" class="timer-text">150</span><span class="timer-unit timer-text">s</span>
    </div>
    <!-- 3. æ‰˜ç›˜åŒºåŸŸ y:530-720 æ‰˜ç›˜ 400Ã—190 -->
    <footer class="game-footer">
      <div class="tray-wrap">
        <div id="tray-slots" class="tray-slots">
          <!-- å¡æ§½ç”± JS åŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>
    </footer>

    <!-- 4. é€‰é¡¹åŒºåŸŸ y:740-820 -->
    <div class="game-actions">
      <button type="button" class="action-btn" id="prop-remove" title="ç§»å‡º">
        <img src="/assets/images/icons/props/remove.png" alt="ç§»å‡º" class="action-btn-icon">
      </button>
      <button type="button" class="action-btn" id="prop-shuffle" title="æ´—ç‰Œ">
        <img src="/assets/images/icons/props/shuffle.png" alt="æ´—ç‰Œ" class="action-btn-icon">
      </button>
      <button type="button" class="action-btn" id="prop-undo" title="æ’¤å›">
        <img src="/assets/images/icons/props/undo.png" alt="æ’¤å›" class="action-btn-icon">
      </button>
    </div>
  </div>
  </div>

  <div id="settings-overlay" class="settings-overlay" style="display:none">
    <div class="settings-card">
      <h2 class="settings-title">è®¾ç½®</h2>
      <div class="settings-user">
        <div class="settings-stat">
          <img src="/assets/images/icons/stats/jifen.png" alt="ç§¯åˆ†" class="settings-stat-icon">
          <span>æ€»ç§¯åˆ†</span>
          <strong id="settings-points">0</strong>
        </div>
        <div class="settings-stat">
          <img src="/assets/images/icons/stats/daibi.png" alt="ä»£å¸" class="settings-stat-icon">
          <span>ä»£å¸</span>
          <strong id="settings-credits">0</strong>
        </div>
      </div>
      <div class="settings-tg" id="settings-tg">
        <span class="settings-tg-label">Telegram</span>
        <span class="settings-tg-status" id="settings-tg-status">æœªè¿æ¥</span>
        <button type="button" class="settings-btn" id="btn-connect-tg">è¿æ¥ Telegram</button>
      </div>
      <div class="settings-payment">
        <p class="settings-payment-hint">è¿æ¥ TON é’±åŒ…åå¯å……å€¼è´­ä¹°ä»£å¸</p>
        <div id="settings-ton-connect"></div>
      </div>
      <button type="button" class="settings-btn settings-btn-leaderboard" id="btn-leaderboard">
        <span>ğŸ“Š ç”¨æˆ·æ’è¡Œæ¦œ</span>
      </button>
      <button type="button" class="settings-close" id="btn-settings-close">å…³é—­</button>
    </div>
  </div>

  <div id="leaderboard-overlay" class="leaderboard-overlay" style="display:none">
    <div class="leaderboard-card">
      <h2 class="leaderboard-title">ä»Šæ—¥æ’è¡Œæ¦œ</h2>
      <p class="leaderboard-date" id="leaderboard-date"></p>
      <ul class="leaderboard-list" id="leaderboard-list"></ul>
      <button type="button" class="settings-close" id="btn-leaderboard-close">å…³é—­</button>
    </div>
  </div>

  <div id="result-overlay" class="result-overlay" style="display:none">
    <div class="result-card" id="result-card">
      <h2 class="result-title" id="result-title">æ¸…ç›˜</h2>
      <div class="result-gains">
        <div class="result-gain-item">
          <img src="/assets/images/icons/stats/jifen.png" alt="ç§¯åˆ†" class="result-gain-icon">
          <span class="result-gain-value" id="result-jifen">+ 0</span>
        </div>
        <div class="result-gain-item">
          <img src="/assets/images/icons/stats/daibi.png" alt="ä»£å¸" class="result-gain-icon">
          <span class="result-gain-value" id="result-daibi">+ 0</span>
        </div>
      </div>
      <div class="result-actions">
        <button type="button" class="result-btn" id="btn-retry">
          <img src="/assets/images/icons/dialog/retry.png" alt="é‡æ¥" class="result-btn-icon">
          <span>é‡æ¥</span>
        </button>
        <a href="/" class="result-btn">
          <img src="/assets/images/icons/dialog/home.png" alt="é¦–é¡µ" class="result-btn-icon">
          <span>é¦–é¡µ</span>
        </a>
      </div>
    </div>
  </div>

  <!-- æ¸¸æˆä¼˜å…ˆåŠ è½½ï¼ŒTON Connect å»¶åå¼‚æ­¥åŠ è½½ï¼Œé¿å… config.ton.org è¶…æ—¶é˜»å¡æ¸¸æˆ -->
  <script type="module" src="/js/main.js"></script>
  <script>
    (function() {
      var s = document.createElement('script');
      s.async = true;
      s.src = 'https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js';
      s.onload = function() {
        try {
          if (typeof TON_CONNECT_UI !== 'undefined') {
            var manifestUrl = location.origin + '/tonconnect-manifest.json';
            new TON_CONNECT_UI.TonConnectUI({
              manifestUrl: manifestUrl,
              buttonRootId: 'ton-connect-game'
            });
          }
        } catch (e) { console.warn('TON Connect åˆå§‹åŒ–å¤±è´¥ï¼Œæ¸¸æˆå¯æ­£å¸¸æ¸¸ç©:', e); }
      };
      document.body.appendChild(s);
    })();
  </script>
</body>
</html>
